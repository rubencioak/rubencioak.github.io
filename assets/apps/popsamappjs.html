<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Population vs Sample Regression</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
  
    <style>
        body {
            margin: 0;
            background-color: #2b2b2b;
            color: white;
            font-family: Arial, sans-serif;
        }
        .tabs {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            background-color: #FF6347;
            padding: 0.5rem 1rem;
            width: 100%;
        }
        .tab-button {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            margin-right: 1rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active {
            font-weight: bold;
            border-bottom: 2px solid white;
        }
        #app {
            max-width: 1200px;
            margin: auto;
            aspect-ratio: 1.25/1;
        }
        #app, #how {
            padding-top: 3rem; /* adjust as needed to fit the bar height */
        }
        .plot-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem; /* even smaller horizontal gap between plots */
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        #plot, #betaPlot {
            flex: 1 1 48%;
            height: 500px;
            min-width: 300px;
        }
        @media (max-width: 768px) {
            #plot, #betaPlot {
                flex: 1 1 100%;
        }
        }
        .slider-container {
            text-align: center;
            margin: 1rem auto;
        }
        #sampleSize {
            width: 25%;
            accent-color: #FF6347;
        }
        #sampleLabel {
            margin-top: 0.5rem;
            font-size: 1rem;
        }
        .how-to {
            padding: 2rem;
            max-width: 800px;
            margin: auto;
        }
        #animateButton {
            background-color: #FF6347;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            margin-left: 1rem;
            cursor: pointer;
            border-radius: 5px;
        }
        ol, ul {
            margin-bottom: 1rem;
        }
        ul li {
            margin-bottom: 0.5rem;
        }
        ol li {
            margin-bottom: 0.75rem;
        }
    </style>
</head>
<body>

    <div class="tabs">
        <button class="tab-button active" data-tab="app">Application</button>
        <button class="tab-button" data-tab="how">How to Use</button>
    </div>

    <div class="tab-content" id="app">
        <div class="plot-container" >
            <div id="plot"></div>
            <div id="betaPlot"></div>
        </div>
        <div class="slider-container">
            <input type="range" id="sampleSize" min="1" max="500" value="50">
            <button id="animateButton">‚ñ∂ Animate</button>
            <div id="sampleLabel">Sample Size: 50</div>
        </div>
    </div>

    <div class="tab-content" id="how" style="display:none;">
        <div class="how-to">
            <h2>üìò How to Use the <em>Population vs Sample Regression</em> App</h2>
            <h4>üéØ Objective</h4>
            <p>This app helps you <strong>visually understand</strong> the difference between three concepts:</p>
                <ul>
                    <li>Data generating process (DGP)</li>
                    <li>Population regression line (PRL)</li>
                    <li>Sample regression line (SRL)</li>
                </ul>
            <h4>üìù What is shown?</h4>
            <p>The left-hand side graph shows a cloud of points generated by the next <strong>DGP</strong>:</p>
            <p>
                \[
                y_i = \beta_0 + \beta_1 x_i + \varepsilon_i, \quad \varepsilon_i \sim \mathcal{N}(0, \sigma^2)
                \]
            </p>
            <p>Where: $$\beta_0 = 3,\; \beta_1 = 2,\; and \; \sigma^2=4$$ Together with its <strong>PRL</strong> in white:</p>
            <p>
                \[
                \mathbb{E}\left[y_i|x_i\right] = 3 + 2x_i
                \]
            </p>
            <p>
                Sampled points are colored in <font color="red">red</font>, 
                with its corresponding <strong><font color="red">SPL</font></strong>:
            </p>
            <p>
                \[
                \widehat{y_i} = \widehat{\beta_0} + \widehat{\beta_1}x_i
                \]
            </p>
            <p>
                The right-hand side graph shows the beta estimators from the 
                sample of points in the left-hand side as a function of the sample size.
            </p>
            <h4>üß™ Step-by-Step</h4>
            <p>Try the following steps:
            <ol>
            <li><strong>Click the ‚ñ∂ Animate button </strong>:
                <ul>
                <li>Left: watch how is filled with red dots while the red line gest closer to the white line.</li>
                <li>Right: similarly, watch how the estimated beta in the sample gets closer to the true beta.</li>
                </ul>
            </li>
            <li><strong>Slider</strong>: Adjust the sample size to update both plots.</li>
            </ol>
            
            <h4>üí° Learning Goals</h4>
            <ul>
                <li>Differentiate between sample-based inference and population parameters.</li>
                <li>Get a sense on how the law of large numbers work.</li>
            </ul>

            <h4>üèÅ Chalenge</h4>
            <p>
                Why is the <strong>estimated beta</strong> not equal to the <strong>true beta</strong> 
                when we sample the whole population?
            </p>
            <button id="revealSolution" style="margin-top: 1rem; background-color: #FF6347; color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; border-radius: 5px;">
                üìñ Show Solution
            </button>
            <div id="solutionText" style="display:none; margin-top: 1rem;">
                <p><strong>Solution:</strong></p>
                <ul>
                    <li>
                        <strong>In theory:</strong> there is <strong>not much differnece</strong> between the 
                        DGP and the population parameters, think of the DGP as the engine of a car and 
                        the population parameters as the specifications of this engine like rpm, horsepower, etc. and
                        we usually refer to them indistinctinly. 
                    </li>
                    <li>
                        <strong>In practice:</strong> you can think that 
                        the <strong>whole population data is a sample</strong> drawn by nature following its DGP. 
                        Because of this, the estimated beta when we take the whole population is not equal 
                        as the true beta.
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
    const n = 500;
    let x = Array.from({length: n}, () => Math.random() * 10);
    let y = x.map(val => 3 + 2 * val + randn_bm() * 4);
    let indices = [...Array(n).keys()].sort(() => Math.random() - 0.5);
    let betaHistory = [];
    let animationInterval = null;

    function randn_bm() {
        let u = 0, v = 0;
        while(u === 0) u = Math.random();
        while(v === 0) v = Math.random();
        return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
    }

    function linreg(x, y) {
        const n = x.length;
        const meanX = x.reduce((a,b) => a + b, 0) / n;
        const meanY = y.reduce((a,b) => a + b, 0) / n;
        const covXY = x.map((xi, i) => (xi - meanX) * (y[i] - meanY)).reduce((a,b) => a + b, 0);
        const varX = x.map(xi => (xi - meanX)**2).reduce((a,b) => a + b, 0);
        const slope = covXY / varX;
        const intercept = meanY - slope * meanX;
        return {slope, intercept};
    }

    function updatePlots(sampleSize) {
        const sampleIdx = indices.slice(0, sampleSize);
        const sampleX = sampleIdx.map(i => x[i]);
        const sampleY = sampleIdx.map(i => y[i]);

        const popReg = linreg(x, y);
        const sampReg = linreg(sampleX, sampleY);

        betaHistory[sampleSize - 1] = sampReg.slope;

        const xLine = [0, 10];
        const popY = xLine.map(xi => popReg.intercept + popReg.slope * xi);
        const sampY = xLine.map(xi => sampReg.intercept + sampReg.slope * xi);

        Plotly.newPlot('plot', [
        {
            x: x,
            y: y,
            mode: 'markers',
            name: 'Population',
            marker: {color: 'white', opacity: 0.5, size: 3}
        },
        {
            x: sampleX,
            y: sampleY,
            mode: 'markers',
            name: 'Sample',
            marker: {color: '#FF6347', size: 3}
        },
        {
            x: xLine,
            y: popY,
            mode: 'lines',
            name: 'Population Line',
            line: {color: 'white', width: 2}
        },
        {
            x: xLine,
            y: sampY,
            mode: 'lines',
            name: 'Sample Line',
            line: {color: '#FF6347', width: 2}
        }
        ], {
        plot_bgcolor: '#2b2b2b',
        paper_bgcolor: '#2b2b2b',
        font: {color: 'white'},
        xaxis: {title: 'X'},
        yaxis: {title: 'Y'},
        title: 'Population vs Sample Regression',
        legend: {x: 0.05, y: 0.95, bgcolor: 'rgba(0,0,0,0)'}
        });

        const x_vals = Array.from({length: sampleSize}, (_, i) => i + 1);
        const beta_vals = x_vals.map(i => betaHistory[i - 1]);

        Plotly.newPlot('betaPlot', [
        {
            x: x_vals,
            y: beta_vals,
            mode: 'lines',
            name: 'Estimated Beta',
            line: {color: '#FF6347', width: 2}
        },
        {
            x: [1, n],
            y: [2, 2],
            mode: 'lines',
            name: 'True Beta',
            line: {color: 'white', dash: 'dot'}
        }
        ], {
        plot_bgcolor: '#2b2b2b',
        paper_bgcolor: '#2b2b2b',
        font: {color: 'white'},
        xaxis: {title: 'Sample Size', range: [1, n]},
        yaxis: {title: 'Beta Estimate'},
        title: 'Beta Estimate over Sample Size',
        legend: {x: 0.05, y: 0.95, bgcolor: 'rgba(0,0,0,0)'}
        });
    }

    const slider = document.getElementById('sampleSize');
    const label = document.getElementById('sampleLabel');
    const animateBtn = document.getElementById('animateButton');

    slider.addEventListener('input', (e) => {
        if (animationInterval !== null) {
        clearInterval(animationInterval);
        animationInterval = null;
        }
        const size = parseInt(e.target.value);
        label.innerText = `Sample Size: ${size}`;
        updatePlots(size);
    });

    animateBtn.addEventListener('click', () => {
        let i = 1;
        animationInterval = setInterval(() => {
        slider.value = i;
        label.innerText = `Sample Size: ${i}`;
        updatePlots(i);
        i++;
        if (i > 500) {
            clearInterval(animationInterval);
            animationInterval = null;
        }
        }, 30);
    });

    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = 'none');
        btn.classList.add('active');
        document.getElementById(btn.getAttribute('data-tab')).style.display = 'block';
        });
    });

    updatePlots(50);
    </script>
    <script>
    document.getElementById('revealSolution').addEventListener('click', () => {
        const sol = document.getElementById('solutionText');
        sol.style.display = sol.style.display === 'none' ? 'block' : 'none';
    });
    </script>
</body>
</html>
